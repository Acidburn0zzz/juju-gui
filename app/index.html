<!DOCTYPE html>
<html manifest="/juju-ui/assets/manifest.appcache">
<!-- !IE will be true for all non-IE browsers and IE10 since it does not
 recognize conditional flags. -->
<!--[if !IE]><!--><script>
if (/*@cc_on!@*/false) {
  // Only IE10 has cc_on as false.
  document.documentElement.className+=' ie10';
}
</script><!--<![endif]-->

<head>
    <title>Juju Admin</title>
    <!-- Disable backwards compatible mode for IE on an intranet.
         For an explanation see http://bit.ly/14VytlD
         Also note it this must be the first <meta> to appear. -->
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Juju team">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/juju-ui/assets/combined-css/all-static.css">
    <link rel="stylesheet" href="/juju-ui/assets/juju-gui.css">
    <link rel="stylesheet" href="/juju-ui/assets/sprite.css">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
      <!-- This <img> tag is here just to force early loading of the background
        image so it displays more quickly.  This makes a large improvment to the
        way the app looks while loading on a slow connection. -->
      <img src="/juju-ui/assets/images/pattern_tile.png" style="display: none;">

      <div id="full-screen-mask" class="crosshatch-background">
        <div id="browser-warning" class="centered-column"
            style="display:none;">
          <i class="sprite juju_logo" title="Juju GUI"></i>
          <div class="panel">
            <div class="header">
              <div class="error">
                <span><i class="sprite alert_icon2"></i>
                <h4>Your browser is not fully supported</h4></span>
              </div>
            </div>
            <p>
              If you continue to use Juju with your current browser your
              experience may not be as good as we would like it to be.
            </p>
            <p>
              Please use the latest version of
              <a href="http://www.google.com/chrome">Chrome</a> to be fully
              supported.
            </p>
            <form onsubmit="return continueWithCurrentBrowser();">
              <input type="submit" value="Continue"/>
            </form>
          </div>
        </div>
        <div id="loading-message" class="centered-column">
          <i class="sprite juju_logo" title="Juju GUI"></i>
          <div class="panel">
            <div id="loading-message-text" class="header">
              Loading the Juju GUI
            </div>
            <div id="loading-spinner"></div>
          </div>
        </div>
      </div>
      <div id="notifier-box"></div>
      <div id="viewport-wrapper">
        <div id="vp-left-border"></div>
        <div id="viewport">
            <div class="navbar">
              <div id="nav-brand-env">
                <span>
                  <a class="brand" href="/">
                    <i class="sprite juju_logo" title="Juju GUI"></i>
                  </a>
                </span>
                <span class="nav-container">
                  <span class="nav-section">
                    <i class="sprite environment_icon"></i>
                    <span id="environment-name"></span>
                    <span id="provider-type" class="provider-type"></span>
                  </span>
                </span>
              </div>
              <div id="nav-alerts-charms">
                <span class="nav-container">
                  <span class="nav-section">
                    <i class="sprite alert_icon"></i>
                    Alerts
                    <span id="notifications"></span>
                  </span>
                </span>
                <span class="nav-container">
                  <span class="nav-section active-border">
                    <a href="/logout/" id="logout-trigger">Logout</a>
                  </span>
                </span>
                <span class="nav-container" id="charm-search-trigger-container">
                  <span class="nav-section active-border">
                    <span id="charm-search-trigger">
                      <i id="charm-search-icon" class="sprite charm_icon"></i>
                      Charms
                      <i id="charm-search-chevron" class="sprite chevron_down"></i>
                    </span>
                    <input type="text" id="charm-search-field"
                     required="required" placeholder="Search for a charm" />
                  </span>
                </span>
              </div>
            </div>

            <div id="content">
                <div id="main">
                </div> <!-- /container -->
            </div>

        </div>
        <div id="vp-right-border"></div>
    </div>
    <script src="/juju-ui/assets/javascripts/spin.min.js"></script>
    <script id="app-startup">
      startSpinner = function() {
        var opts = {
          lines: 17, // The number of lines to draw
          length: 0, // The length of each line
          width: 3, // The line thickness
          radius: 30, // The radius of the inner circle
          corners: 1, // Corner roundness (0..1)
          rotate: 14, // The rotation offset
          color: '#000', // #rgb or #rrggbb
          speed: 1.3, // Rounds per second
          trail: 60, // Afterglow percentage
          shadow: false, // Whether to render a shadow
          hwaccel: true, // Whether to use hardware acceleration
          className: 'spinner', // The CSS class to assign to the spinner
          zIndex: 2e9, // The z-index (defaults to 2000000000)
          top: '15', // Top position relative to parent in px
          left: 'auto' // Left position relative to parent in px
        };
        var document = getDocument();
        var target = document.getElementById('loading-spinner');
        // If we are in a testing environment, then actually starting the
        // spinner is unneccesary and counter productive.
        if (target.style !== undefined) {
          spinner = new Spinner(opts).spin(target);
        }
      };

      setLoadingMessageText = function(newText) {
        getDocument()
          .getElementById('loading-message-text').innerHTML = newText;
      };

      isBrowserSupported = function(agent) {
        // At the moment only Chrome is supported.
        return (/Chrome/.test(agent));
      };

      getDocument = function() {
        return document;
      };

      displayBrowserWarning = function() {
        getDocument()
          .getElementById('browser-warning').style.display = 'block';
      };

      hideBrowserWarning = function() {
        getDocument()
          .getElementById('browser-warning').style.display = 'none';
      };

      displayLoadingMessage = function() {
        getDocument()
          .getElementById('loading-message').style.display = 'block';
      };

      hideLoadingMessage = function() {
        getDocument()
          .getElementById('loading-message').style.display = 'none';
      };

      continueWithCurrentBrowser = function() {
        hideBrowserWarning();
        displayLoadingMessage();
        startTheApp();
        // Signal that we want to stop event propagation.
        return false;
      };

      startTheApp = function() {
        // This function will be redefined when all the app's JavaScript is
        // loaded.  We want to keep trying until that happens.

        // Tell jslint that we really do want to evaluate a string:
        /*jslint evil: true */
        window.setTimeout('startTheApp()', 100);
      };

      go = function(agent) {
        if (isBrowserSupported(agent)) {
          startTheApp();
        } else {
          hideLoadingMessage();
          displayBrowserWarning();
        }
      };
    </script>
    <script>
      // This code is here instead of in the "app-startup" script tag above
      // because we extract that JS in order to test it.  This bit here is just
      // to bootstrap the app when actually loaded into a browser.
      startSpinner();
      go(navigator.userAgent);
    </script>
    <!--
      Load the (potentially slow to download) core of the app.  We do this here
      because we want the browser warning to execute before spending the time
      to download an app the user might not be able to use anyway.
    -->
    <script src="/juju-ui/assets/all-yui.js"></script>
    <script src="/juju-ui/assets/modules.js"></script>
    <script src="/juju-ui/assets/config.js"></script>
    <script>
      // Now that all of the above JS is loaded we can define the real start
      // function which will be picked up by the setTimeout and the app will
      // start.
      startTheApp = function() {
        setLoadingMessageText('Trying to connect to the Juju environment');
        YUI(GlobalConfig).use(['juju-gui'], function(Y) {
          if (!juju_config.socket_url) {
            // Assemble a socket URL from the Location if one isn't
            // provided.
            var loc = Y.getLocation();
            var port = juju_config.socket_port || loc.port;
             var protocol = juju_config.socket_protocol || 'ws';
            juju_config.socket_url = protocol + '://' + loc.hostname;
            if (port) {
              juju_config.socket_url += ':' + port;
            }
            juju_config.socket_url += '/ws';
            console.log('websocket url', juju_config.socket_url);
          }
          app = new Y.juju.App(juju_config);
          // We need to activate the hotkeys when running the application
          // in production. Unit tests should call it manually.
          app.activateHotkeys();
        });
      };
    </script>
  </body>
</html>
